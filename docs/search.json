[
  {
    "objectID": "index.html#overview",
    "href": "index.html#overview",
    "title": "",
    "section": "Overview",
    "text": "Overview\nThis report provides a reproducible pipeline for processing, geocoding, and classifying CNPJs from the Brazilian Annual Social Information Report (RAIS) of the Brazilian Ministry of Labor and Employment (MTE) using the Locais-Nova scale.\nFor instructions on how to run the pipeline, see the repository README."
  },
  {
    "objectID": "index.html#problem",
    "href": "index.html#problem",
    "title": "",
    "section": "Problem",
    "text": "Problem\nThe AcessoSAN project aims to develop methods for measuring and analyzing inequities in access to healthy food in favelas and other urban communities. Achieving this requires a reliable and up-to-date database of food establishments.\nThe Brazilian Annual Social Information Report (RAIS) database of the Brazilian Ministry of Labor and Employment (MTE) lists companies operating in Brazil, including food establishments. However, it does not provide geocoded information, which is required for spatial analyses. This pipeline addresses that gap by processing and geocoding the data, and classifying establishments according to the Locais-Nova scale."
  },
  {
    "objectID": "index.html#data-availability",
    "href": "index.html#data-availability",
    "title": "",
    "section": "Data Availability",
    "text": "Data Availability\n\n\n\nThe processed data are available in csv, rds and parquet formats through a dedicated repository on the Open Science Framework (OSF). A metadata file is included alongside the validated datasets.\nBecause the raw data are not publicly available, only authorized personnel can access the processed files. They are protected with RSA 4096-bit encryption (OpenSSL) and a 32-byte password to ensure data security.\nIf you already have access to the OSF repository and the project keys, click here to access the data. You can also retrieve these files directly from R using the osfr package."
  },
  {
    "objectID": "index.html#methods",
    "href": "index.html#methods",
    "title": "",
    "section": "Methods",
    "text": "Methods\nSource of Data\nThe data used in this report come from the following sources:\n\nBrazilian Ministry of Labor and Employment (MTE): Data on food establishments from the Annual Social Information Report (RAIS) related to 2022, provided by request, used for company identification.\nBrazilian Federal Revenue Service (RFB): Data on legal entities from the National Register of Legal Entities (CNPJ).\nBrazilian Institute of Geography and Statistics (IBGE):\n\nMunicipality data via the geobr R package.\nOpen spatial datasets of Brazilian addresses from the National Address Register for Statistical Purposes (CNEFE), used for geocoding via the geocodebr R package.\n\n\nCenter for Metropolitan Studies (CEM): Lookup table providing the classification linking the establishments CNAEs (National Classification of Economic Activities) codes to the Locais-Nova groups. This data will remain private until further notice.\nData Munging\nThe data munging follow the data science workflow outlined by Wickham et al. (2023), as illustrated in Figure 1. All processes were made using the Quarto publishing system, along with the AWK (Aho et al., 2023) and R (R Core Team, n.d.) programming languages, supported by several R packages.\nFor data manipulation and workflow, priority was given to packages from the tidyverse, rOpenSci and r-spatial ecosystems, as well as other packages adhering to the tidy tools manifesto (Wickham, 2023).\n\n\nFigure 1: Data science workflow created by Wickham, Çetinkaya-Runde, and Grolemund.\n\n\nSource: Reproduced from Wickham et al. (2023).\n\n\n\nCode Style\nThe Tidyverse code style guide and design principles were followed to ensure consistency and enhance readability.\nReproducibility\nThe pipeline is fully reproducible and can be run again at any time. To ensure consistent results, the renv package (Ushey & Wickham, n.d.) is used to manage and restore the R environment. See the README file in the code repository to learn how to run it."
  },
  {
    "objectID": "index.html#set-the-environment",
    "href": "index.html#set-the-environment",
    "title": "",
    "section": "Set the Environment",
    "text": "Set the Environment\n\n\n\n\n\n\nThis section sets up the R environment needed for the workflow.\n\n\n\nLoad Packages\n\nlibrary(askpass)\nlibrary(brandr)\nlibrary(beepr)\nlibrary(curl)\nlibrary(dplyr)\nlibrary(fs)\nlibrary(geobr)\nlibrary(geocodebr)\nlibrary(ggplot2)\nlibrary(googlesheets4)\nlibrary(here)\nlibrary(htmltools)\nlibrary(labelled)\nlibrary(lockr) # github.com/danielvartan/lockr\nlibrary(lubridate)\nlibrary(magrittr)\nlibrary(nanoparquet)\nlibrary(orbis) # github.com/danielvartan/orbis\nlibrary(osfr)\nlibrary(purrr)\nlibrary(readr)\nlibrary(rvest)\nlibrary(rutils) # github.com/danielvartan/rutils\nlibrary(sf)\nlibrary(stringr)\nlibrary(tidyr)\nlibrary(vroom)\nlibrary(zip)\n\nSet Keys\n\n\n\n\n\n\nSee the Data Availability section for more information.\n\n\n\n\nosf_auth(Sys.getenv(\"OSF_PAT\")) # askpass())\n\n\ngs4_auth(cache = \".secrets\")\n\n\npublic_key &lt;- here(\"_ssh\", \"id_rsa.pub\")\n\n\nprivate_key &lt;- here(\"_ssh\", \"id_rsa\")\n\n\npassword &lt;- Sys.getenv(\"ACESSOSAN_PASSWORD\") # askpass()\n\nSet Input and Output Paths\n\nraw_data_dir &lt;- here(\"data-raw\")\ndata_dir &lt;- here(\"data\")\n\n\nfor (i in c(raw_data_dir, data_dir)) {\n  if (!dir_exists(i)) dir_create(i, recurse = TRUE)\n}\n\nSet Initial Variables\n\n\n\n\n\n\nThese variables specify which consolidated RFB dataset to use and which municipalities to process.\n\n\n\n\nset.seed(2025)\n\n\nset_en_us_locale()\n\n\nyear &lt;- 2025\n\n\nmonth &lt;- 1\n\n\nmunicipalities &lt;- c( # IBGE Codes\n  1721000, # Palmas\n  2507507, # João Pessoa\n  3106200, # Belo Horizonte\n  3550308, # São Paulo\n  4314902, # Porto Alegre\n  5208707, # Goiânia\n  5300108 # Brasília\n)"
  },
  {
    "objectID": "index.html#download-locais-nova-cnae-lookup-table",
    "href": "index.html#download-locais-nova-cnae-lookup-table",
    "title": "",
    "section": "Download Locais-Nova CNAE Lookup Table",
    "text": "Download Locais-Nova CNAE Lookup Table\n\n\n\n\n\n\nSee the Source of Data section for more information.\n\n\n\n\nlookup_data &lt;-\n  read_sheet(\n    ss = \"1ipCw2FM3aUOdRd4w55J5SUEgXDCogxWZF-NZi0A-o_4\",\n    sheet = \"Dataset\"\n  ) |&gt;\n  mutate(\n    g0 = if_else(\n      g1_g2 == TRUE & g3 == FALSE & g4 == FALSE,\n      TRUE,\n      FALSE\n    )\n  )\n#&gt; ✔ Reading from \"Locais-Nova By CNAE\".\n#&gt; ✔ Range ''Dataset''.\n\n\nlookup_data |&gt; glimpse()\n#&gt; Rows: 540\n#&gt; Columns: 7\n#&gt; $ cnae         &lt;chr&gt; \"4711302\", \"5611201\", \"4722902\", \"4721102\", \"4721101\",…\n#&gt; $ description  &lt;chr&gt; \"Supermarket 1\", \"Restaurant\", \"Fish Market\", \"Bakery …\n#&gt; $ federal_unit &lt;chr&gt; \"AC\", \"AC\", \"AC\", \"AC\", \"AC\", \"AC\", \"AC\", \"AC\", \"AC\", …\n#&gt; $ g0           &lt;lgl&gt; FALSE, TRUE, TRUE, FALSE, FALSE, FALSE, FALSE, FALSE, …\n#&gt; $ g1_g2        &lt;lgl&gt; TRUE, TRUE, TRUE, FALSE, FALSE, FALSE, FALSE, FALSE, F…\n#&gt; $ g3           &lt;lgl&gt; FALSE, FALSE, FALSE, TRUE, TRUE, FALSE, FALSE, TRUE, F…\n#&gt; $ g4           &lt;lgl&gt; TRUE, FALSE, FALSE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE…"
  },
  {
    "objectID": "index.html#download-agencies-and-municipalities-tom-data",
    "href": "index.html#download-agencies-and-municipalities-tom-data",
    "title": "",
    "section": "Download Agencies and Municipalities (TOM) Data",
    "text": "Download Agencies and Municipalities (TOM) Data\n\n\n\n\n\n\nSee the Source of Data section for more information.\n\n\n\n\nurl &lt;- \"https://www.gov.br/receitafederal/dados/municipios.csv\"\n\n\ncurl_download(url, destfile = file.path(raw_data_dir, \"municipios.csv\"))"
  },
  {
    "objectID": "index.html#download-and-import-ibge-municipalities-data",
    "href": "index.html#download-and-import-ibge-municipalities-data",
    "title": "",
    "section": "Download and Import IBGE Municipalities Data",
    "text": "Download and Import IBGE Municipalities Data\n\n\n\n\n\n\nSee the Source of Data section for more information.\n\n\n\n\nmunicipalities_data &lt;- brazil_municipality(year = year)\n#&gt; ! The closest map year to 2025 is 2022. Using year 2022 instead.\n#&gt; Using year/date 2022\n\n\nmunicipalities_data |&gt; glimpse()\n#&gt; Rows: 5,570\n#&gt; Columns: 9\n#&gt; $ region_code       &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…\n#&gt; $ region            &lt;chr&gt; \"North\", \"North\", \"North\", \"North\", \"North\", \"Nor…\n#&gt; $ state_code        &lt;int&gt; 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 1…\n#&gt; $ state             &lt;chr&gt; \"Rondônia\", \"Rondônia\", \"Rondônia\", \"Rondônia\", \"…\n#&gt; $ federal_unit      &lt;chr&gt; \"RO\", \"RO\", \"RO\", \"RO\", \"RO\", \"RO\", \"RO\", \"RO\", \"…\n#&gt; $ municipality_code &lt;dbl&gt; 1100015, 1100023, 1100031, 1100049, 1100056, 1100…\n#&gt; $ municipality      &lt;chr&gt; \"Alta Floresta D'Oeste\", \"Ariquemes\", \"Cabixi\", \"…\n#&gt; $ latitude          &lt;dbl&gt; -11.935540305, -9.908462867, -13.499763460, -11.4…\n#&gt; $ longitude         &lt;dbl&gt; -61.99982390, -63.03326928, -60.54431358, -61.442…"
  },
  {
    "objectID": "index.html#download-rais-data",
    "href": "index.html#download-rais-data",
    "title": "",
    "section": "Download RAIS Data",
    "text": "Download RAIS Data\n\n\n\n\n\n\nSee the Source of Data section for more information.\n\n\n\nDownload File\n\nosf_raw_data_id &lt;- \"tdswp\"\n\n\nosf_raw_data_files &lt;-\n  osf_raw_data_id |&gt;\n  osf_retrieve_node() |&gt;\n  osf_ls_files(\n    type = \"file\",\n    pattern = \"rais_alim_\",\n    n_max = Inf\n  )\n\nosf_raw_data_files\n\n\n  \n\n\n\n\nrais_file &lt;-\n  osf_raw_data_files |&gt;\n  osf_download(path = raw_data_dir, conflicts = \"overwrite\") |&gt;\n  extract2(\"local_path\")\n\nUnlock File\n\nrais_file |&gt;\n  unlock_file(\n    private_key = private_key,\n    suffix = \".lockr\",\n    remove_file = TRUE,\n    password = password\n  )"
  },
  {
    "objectID": "index.html#download-rfb-data",
    "href": "index.html#download-rfb-data",
    "title": "",
    "section": "Download RFB Data",
    "text": "Download RFB Data\n\n\n\n\n\n\nSee the Source of Data section for more information.\n\n\n\nDownload Files\n\nroot &lt;- file.path( # Don´t change the function!\n    \"https://arquivos.receitafederal.gov.br\",\n    \"dados\",\n    \"cnpj\",\n    \"dados_abertos_cnpj\"\n  )\n\n\npath &lt;- root |&gt; file.path(paste0(\"2025-\", str_pad(month, 2, pad = 0)))\n\nurls &lt;-\n  path |&gt;\n  read_html() |&gt;\n  html_elements(\"a\") |&gt;\n  html_attr(\"href\") |&gt;\n  str_subset(\"\\\\.zip$\") %&gt;%\n  file.path(path, .)\n\n\nurls |&gt;\n  map_dbl(.f = get_file_size, .progress = TRUE) |&gt;\n  sum() |&gt;\n  as_fs_bytes()\n#&gt; 6.26G\n\n\nurls |&gt; download_file(dir = raw_data_dir)\n\nUnzip Files\n\nzip_files &lt;- raw_data_dir |&gt; dir_ls(type = \"file\", regexp = \"\\\\.zip$\")\n\n\nzip_files |&gt; map(\\(x) unzip(x, exdir = raw_data_dir), .progress = TRUE)\n\n\nzip_files |&gt; file_delete()"
  },
  {
    "objectID": "index.html#import-agencies-and-municipalities-tom-data",
    "href": "index.html#import-agencies-and-municipalities-tom-data",
    "title": "",
    "section": "Import Agencies and Municipalities (TOM) Data",
    "text": "Import Agencies and Municipalities (TOM) Data\n\n\n\n\n\n\nRFB data identifies municipalities using a different coding scheme (Tabela de Órgãos e Municípios, TOM) than IBGE codes. Mapping IBGE codes to the corresponding TOM codes is therefore required.\n\n\n\n\nmunicipalities_tom_data &lt;-\n  raw_data_dir |&gt;\n  path(\"municipios.csv\") |&gt;\n  read_delim(\n    delim = \";\",\n    col_names = FALSE,\n    col_types = cols(.default = \"c\"),\n    progress = FALSE\n  ) |&gt;\n  slice(-1) |&gt;\n  mutate(\n    across(\n      .cols = everything(),\n      .fns = \\(x) iconv(x, from = \"Windows-1252\", to = \"UTF-8\") # iconvlist()\n    )\n  ) |&gt;\n  rename_with(\n    \\(x) c(\n    \"municipality_code_tom\",\n    \"municipality_code_ibge\",\n    \"municipality_tom\",\n    \"municipality_ibge\",\n    \"uf\"\n    )\n  ) |&gt;\n  mutate(\n    municipality_code_tom = as.integer(municipality_code_tom),\n    municipality_code_ibge = as.integer(municipality_code_ibge)\n  )\n\n\nmunicipalities_tom_data |&gt; glimpse()\n#&gt; Rows: 5,571\n#&gt; Columns: 5\n#&gt; $ municipality_code_tom  &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 1…\n#&gt; $ municipality_code_ibge &lt;int&gt; 1100106, 1100379, 1100205, 1100452, 1100122,…\n#&gt; $ municipality_tom       &lt;chr&gt; \"GUAJARÁ-MIRIM\", \"ALTO ALEGRE DOS PARECIS\", …\n#&gt; $ municipality_ibge      &lt;chr&gt; \"Guajará-Mirim\", \"Alto Alegre dos Parecis\", …\n#&gt; $ uf                     &lt;chr&gt; \"RO\", \"RO\", \"RO\", \"RO\", \"RO\", \"RO\", \"RO\", \"R…"
  },
  {
    "objectID": "index.html#import-data",
    "href": "index.html#import-data",
    "title": "",
    "section": "Import Data",
    "text": "Import Data\n\nestablishment_data &lt;-\n  raw_data_dir |&gt;\n  path(\"rais_alim_2022.parquet\") |&gt;\n  read_parquet()\n\n\nestablishment_data |&gt; glimpse()\n#&gt; Rows: 731,497\n#&gt; Columns: 30\n#&gt; $ X                        &lt;int&gt; 10, 17, 27, 31, 80, 85, 91, 103, 111, 119,…\n#&gt; $ nu_cei_vinculado         &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …\n#&gt; $ nu_cep_estab             &lt;int&gt; 6755185, 76650000, 95880000, 35600000, 790…\n#&gt; $ co_cnae95_classe         &lt;int&gt; 52248, 55212, 55247, 52124, 55212, 52132, …\n#&gt; $ nu_cnpj_cei              &lt;dbl&gt; 5046455000161, 30119065000111, 15393330000…\n#&gt; $ nu_cnpj_raiz             &lt;int&gt; 5046455, 30119065, 15393330, 2508004, 2756…\n#&gt; $ dt_abertura              &lt;chr&gt; \"2002-04-19\", \"2018-04-05\", \"2012-04-16\", …\n#&gt; $ dt_baixa                 &lt;chr&gt; \"\", \"\", \"\", \"\", \"2019-09-26\", \"2023-08-01\"…\n#&gt; $ dt_encerramento          &lt;chr&gt; \"\", \"\", \"\", \"\", \"2019-09-26\", \"2023-08-01\"…\n#&gt; $ ds_email_estab           &lt;chr&gt; \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\", \"\"…\n#&gt; $ in_cei_vinculado         &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …\n#&gt; $ id_estab_participa_pat   &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …\n#&gt; $ in_rais_negativa         &lt;int&gt; 0, 1, 0, 0, 0, 1, 1, 0, 0, 1, 0, 0, 0, 0, …\n#&gt; $ in_simples               &lt;int&gt; 0, 1, 1, 0, 0, 1, 0, 1, 0, 0, 0, 1, 1, 1, …\n#&gt; $ co_municipio             &lt;int&gt; 355280, 521056, 430780, 310740, 500270, 41…\n#&gt; $ co_natureza_juridica     &lt;int&gt; 2062, 2135, 2135, 2062, 2135, 2062, 2062, …\n#&gt; $ no_logradouro            &lt;chr&gt; \"R SANTO ONOFRE 200 TERREO.\", \"R 01 SN QUA…\n#&gt; $ nu_logradouro            &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …\n#&gt; $ no_bairro                &lt;chr&gt; \"JARDIM SANTA ROSA\", \"RESIDENCIAL BENEDITO…\n#&gt; $ nu_tel_empresa           &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …\n#&gt; $ qt_vinculos_ativos       &lt;int&gt; 21, 0, 0, 1, 4, 0, 0, 4, 2, 0, 93, 4, 6, 1…\n#&gt; $ qt_vinculos_clt          &lt;int&gt; 21, 0, 0, 1, 4, 0, 0, 4, 2, 0, 93, 4, 6, 1…\n#&gt; $ qt_vinculos_estatutarios &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …\n#&gt; $ no_razao_social          &lt;chr&gt; \"ANSERVE COMERCIAL LTDA - ME\", \"0\", \"NÃO I…\n#&gt; $ in_tamanho_estab         &lt;int&gt; 5, 1, 1, 2, 2, 1, 1, 2, 2, 1, 6, 2, 3, 2, …\n#&gt; $ tp_estabelecimento       &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, …\n#&gt; $ co_ibge_subsetor         &lt;int&gt; 16, 21, 13, 16, 21, 16, 21, 16, 16, 21, 16…\n#&gt; $ in_atividade_ano         &lt;int&gt; 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, …\n#&gt; $ co_cnae20_classe         &lt;int&gt; 47237, 56112, 56201, 47113, 56112, 47121, …\n#&gt; $ co_cnae20_subclasse      &lt;int&gt; 4723700, 5611201, 5620104, 4711302, 561120…"
  },
  {
    "objectID": "index.html#filter-data",
    "href": "index.html#filter-data",
    "title": "",
    "section": "Filter Data",
    "text": "Filter Data\n\n\n\n\n\n\nOnly establishments with an Active registration status (in_atividade_ano == 9) and no negative records (in_rais_negativa == 0 | (in_rais_negativa == 1 & qt_vinculos_ativos &gt; 0)) are retained. The data is then filtered by municipality, and duplicate CNPJs are removed.\nThe Locais-Nova lookup table is subsequently used to filter establishment data and classify establishments into the scale groups.\nFor more details on the Locais-Nova lookup table, see the Source of Data section.\n\n\n\n\nestablishment_data &lt;-\n  establishment_data |&gt;\n  select(\n    nu_cnpj_cei, dt_abertura, in_atividade_ano, in_rais_negativa,\n    co_municipio, qt_vinculos_ativos, in_atividade_ano, co_cnae20_subclasse\n  ) |&gt;\n  filter(\n    in_atividade_ano == 9 &\n    (in_rais_negativa == 0 | (in_rais_negativa == 1 & qt_vinculos_ativos &gt; 0))\n  ) |&gt;\n  mutate(\n    cnpj = str_pad(as.character(nu_cnpj_cei), 14, pad = \"0\"),\n    cnae = str_pad(co_cnae20_subclasse, 7, pad = \"0\"),\n    registration_status_date = ymd(dt_abertura)\n  ) |&gt;\n  # distinct(cnpj, .keep_all = TRUE) |&gt;\n  left_join(\n    municipalities_data |&gt;\n      mutate(\n        municipality_code_6 =\n          municipality_code |&gt;\n          str_sub(1, 6) |&gt;\n          as.integer()\n      ),\n    by = join_by(co_municipio == municipality_code_6)\n  ) |&gt;\n  filter(municipality_code %in% municipalities) |&gt;\n  left_join(lookup_data, by = c(\"cnae\", \"federal_unit\")) |&gt;\n  rename(\n    locaisnova_g0 = g0,\n    locaisnova_g1_g2 = g1_g2,\n    locaisnova_g3 = g3,\n    locaisnova_g4 = g4\n  ) |&gt;\n  drop_na(locaisnova_g0, locaisnova_g1_g2, locaisnova_g3, locaisnova_g4) |&gt;\n  select(\n    cnpj, cnae, registration_status_date,\n    region_code, region, state_code, state, federal_unit,\n    municipality_code, municipality,\n    locaisnova_g0, locaisnova_g1_g2, locaisnova_g3, locaisnova_g4\n  )\n\n\nestablishment_data |&gt; glimpse()\n#&gt; Rows: 71,412\n#&gt; Columns: 14\n#&gt; $ cnpj                     &lt;chr&gt; \"37278286000181\", \"38483830000351\", \"31275…\n#&gt; $ cnae                     &lt;chr&gt; \"4721102\", \"4722901\", \"5611203\", \"5611201\"…\n#&gt; $ registration_status_date &lt;date&gt; 2020-06-01, 2017-11-13, 2018-08-20, 2018-…\n#&gt; $ region_code              &lt;int&gt; 3, 3, 3, 5, 3, 5, 4, 3, 3, 3, 3, 3, 3, 3, …\n#&gt; $ region                   &lt;chr&gt; \"Southeast\", \"Southeast\", \"Southeast\", \"Ce…\n#&gt; $ state_code               &lt;int&gt; 35, 31, 31, 53, 35, 53, 43, 35, 35, 35, 35…\n#&gt; $ state                    &lt;chr&gt; \"São Paulo\", \"Minas Gerais\", \"Minas Gerais…\n#&gt; $ federal_unit             &lt;chr&gt; \"SP\", \"MG\", \"MG\", \"DF\", \"SP\", \"DF\", \"RS\", …\n#&gt; $ municipality_code        &lt;dbl&gt; 3550308, 3106200, 3106200, 5300108, 355030…\n#&gt; $ municipality             &lt;chr&gt; \"São Paulo\", \"Belo Horizonte\", \"Belo Horiz…\n#&gt; $ locaisnova_g0            &lt;lgl&gt; FALSE, TRUE, FALSE, TRUE, TRUE, TRUE, TRUE…\n#&gt; $ locaisnova_g1_g2         &lt;lgl&gt; FALSE, TRUE, FALSE, TRUE, TRUE, TRUE, TRUE…\n#&gt; $ locaisnova_g3            &lt;lgl&gt; TRUE, FALSE, FALSE, FALSE, FALSE, FALSE, F…\n#&gt; $ locaisnova_g4            &lt;lgl&gt; FALSE, FALSE, TRUE, FALSE, FALSE, FALSE, F…"
  },
  {
    "objectID": "index.html#visualize-registration-status-dates",
    "href": "index.html#visualize-registration-status-dates",
    "title": "",
    "section": "Visualize Registration Status Dates",
    "text": "Visualize Registration Status Dates\n\n\n\n\n\n\nThese dates indicate when establishments were registered as Active.\n\n\n\n\nestablishment_data |&gt;\n  ggplot(aes(x = registration_status_date)) +\n  geom_histogram(\n    bins = 30,\n    fill = get_brand_color(\"blue\")\n  ) +\n  scale_fill_brand_d() +\n  labs(\n    x = \"Registration Status Date\",\n    y = \"Frequency\"\n  )\n#&gt; Warning: Removed 22 rows containing non-finite outside the scale range\n#&gt; (`stat_bin()`)."
  },
  {
    "objectID": "index.html#tidy-the-data",
    "href": "index.html#tidy-the-data",
    "title": "",
    "section": "Tidy the Data",
    "text": "Tidy the Data\n\n\n\n\n\n\nSome tidying operations are performed to ensure the data is in a suitable format for analysis.\n\n\n\n\nestablishment_data &lt;-\n  establishment_data |&gt;\n  mutate(\n    cnpj = if_else(\n      !is.na(cnpj),\n      paste0(\n        str_sub(cnpj, 1, 2),\n        \".\", str_sub(cnpj, 3, 5),\n        \".\", str_sub(cnpj, 6, 8),\n        \"/\", str_sub(cnpj, 9, 12),\n        \"-\", str_sub(cnpj, 13, 14)\n      ),\n      NA_character_\n    ),\n    cnae = if_else(\n      !is.na(cnae),\n      paste0(\n        str_sub(cnae, 1, 4),\n        \"-\", str_sub(cnae, 5, 5),\n        \"/\", str_sub(cnae, 6, 7)\n      ),\n      NA_character_\n    ),\n    municipality_code = as.integer(municipality_code)\n  ) |&gt;\n  select(-registration_status_date)\n\n\nestablishment_data |&gt; glimpse()\n#&gt; Rows: 71,412\n#&gt; Columns: 13\n#&gt; $ cnpj              &lt;chr&gt; \"37.278.286/0001-81\", \"38.483.830/0003-51\", \"31.2…\n#&gt; $ cnae              &lt;chr&gt; \"4721-1/02\", \"4722-9/01\", \"5611-2/03\", \"5611-2/01…\n#&gt; $ region_code       &lt;int&gt; 3, 3, 3, 5, 3, 5, 4, 3, 3, 3, 3, 3, 3, 3, 5, 3, 5…\n#&gt; $ region            &lt;chr&gt; \"Southeast\", \"Southeast\", \"Southeast\", \"Central-W…\n#&gt; $ state_code        &lt;int&gt; 35, 31, 31, 53, 35, 53, 43, 35, 35, 35, 35, 35, 3…\n#&gt; $ state             &lt;chr&gt; \"São Paulo\", \"Minas Gerais\", \"Minas Gerais\", \"Dis…\n#&gt; $ federal_unit      &lt;chr&gt; \"SP\", \"MG\", \"MG\", \"DF\", \"SP\", \"DF\", \"RS\", \"SP\", \"…\n#&gt; $ municipality_code &lt;int&gt; 3550308, 3106200, 3106200, 5300108, 3550308, 5300…\n#&gt; $ municipality      &lt;chr&gt; \"São Paulo\", \"Belo Horizonte\", \"Belo Horizonte\", …\n#&gt; $ locaisnova_g0     &lt;lgl&gt; FALSE, TRUE, FALSE, TRUE, TRUE, TRUE, TRUE, TRUE,…\n#&gt; $ locaisnova_g1_g2  &lt;lgl&gt; FALSE, TRUE, FALSE, TRUE, TRUE, TRUE, TRUE, TRUE,…\n#&gt; $ locaisnova_g3     &lt;lgl&gt; TRUE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, F…\n#&gt; $ locaisnova_g4     &lt;lgl&gt; FALSE, FALSE, TRUE, FALSE, FALSE, FALSE, FALSE, F…"
  },
  {
    "objectID": "index.html#arrange-the-data",
    "href": "index.html#arrange-the-data",
    "title": "",
    "section": "Arrange the Data",
    "text": "Arrange the Data\n\n\n\n\n\n\nThe data is arranged by municipality code and CNAE.\n\n\n\n\nestablishment_data &lt;-\n  establishment_data |&gt;\n  arrange(municipality_code, cnae)\n\n\nestablishment_data |&gt; glimpse()\n#&gt; Rows: 71,412\n#&gt; Columns: 13\n#&gt; $ cnpj              &lt;chr&gt; \"75.315.333/0101-71\", \"75.315.333/0277-32\", \"04.4…\n#&gt; $ cnae              &lt;chr&gt; \"4711-3/01\", \"4711-3/01\", \"4711-3/01\", \"4711-3/01…\n#&gt; $ region_code       &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…\n#&gt; $ region            &lt;chr&gt; \"North\", \"North\", \"North\", \"North\", \"North\", \"Nor…\n#&gt; $ state_code        &lt;int&gt; 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 1…\n#&gt; $ state             &lt;chr&gt; \"Tocantins\", \"Tocantins\", \"Tocantins\", \"Tocantins…\n#&gt; $ federal_unit      &lt;chr&gt; \"TO\", \"TO\", \"TO\", \"TO\", \"TO\", \"TO\", \"TO\", \"TO\", \"…\n#&gt; $ municipality_code &lt;int&gt; 1721000, 1721000, 1721000, 1721000, 1721000, 1721…\n#&gt; $ municipality      &lt;chr&gt; \"Palmas\", \"Palmas\", \"Palmas\", \"Palmas\", \"Palmas\",…\n#&gt; $ locaisnova_g0     &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, …\n#&gt; $ locaisnova_g1_g2  &lt;lgl&gt; TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, T…\n#&gt; $ locaisnova_g3     &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, …\n#&gt; $ locaisnova_g4     &lt;lgl&gt; TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, T…"
  },
  {
    "objectID": "index.html#import-rfb-data",
    "href": "index.html#import-rfb-data",
    "title": "",
    "section": "Import RFB Data",
    "text": "Import RFB Data\n\n\n\n\n\n\nThe company addresses in the RAIS dataset are often incomplete; therefore, the CNPJs are cross-referenced with RFB data to obtain complete addresses.\nThe AWK programming language and the vroom R package are used to read and filter the data efficiently, without loading it entirely into memory.\nOnly establishments located within the specified municipalities are included, and any duplicate CNPJs are removed.\n\n\n\n\nrfb_data &lt;-\n  raw_data_dir |&gt;\n  dir_ls(type = \"file\", regexp = \"\\\\.ESTABELE$\") |&gt;\n  map(\n    function(x) {\n      vroom(\n        file = pipe(\n          paste0(\n            \"awk \",\n            \"-F \",\n            \"';' \",\n            \"'{ \",\n            \"if (\",\n            paste0(\n              '$21 == \"\\\\\"',\n              municipalities_tom_data |&gt;\n                filter(municipality_code_ibge %in% municipalities) |&gt;\n                pull(municipality_code_tom),\n              '\\\\\"\"',\n              collapse = \" || \"\n            ),\n            \") \",\n            \"print\",\n            \" }' \",\n            x\n          )\n        ),\n        delim = \";\",\n        col_names = c(\n          \"cnpj_basic\",\n          \"cnpj_order\",\n          \"cnpj_dv\",\n          \"branch_identifier\",\n          \"trade_name\",\n          \"registration_status\",\n          \"registration_status_date\",\n          \"registration_status_reason\",\n          \"foreign_city_name\",\n          \"country\",\n          \"start_date\",\n          \"cnae_primary\",\n          \"cnae_secondary\",\n          \"street_type\",\n          \"street_name\",\n          \"number\",\n          \"address_complement\",\n          \"neighborhood\",\n          \"postal_code\",\n          \"federal_unit\",\n          \"municipality_code_tom\",\n          \"phone_area_code_1\",\n          \"phone_number_1\",\n          \"phone_area_code_2\",\n          \"phone_number_2\",\n          \"fax_area_code\",\n          \"fax_number\",\n          \"email\",\n          \"special_status\",\n          \"special_status_date\"\n        ),\n        col_types = cols(.default = \"c\"),\n        col_select = c(\n          \"cnpj_basic\", \"cnpj_order\", \"cnpj_dv\",\n          \"street_type\", \"street_name\", \"number\", \"address_complement\",\n          \"neighborhood\", \"postal_code\"\n        ),\n        show_col_types = FALSE\n      ) |&gt;\n        distinct(cnpj_basic, cnpj_order, cnpj_dv, .keep_all = TRUE)\n    },\n    .progress = TRUE\n  ) |&gt;\n    list_rbind()\n#&gt;  ■■■■                              10% |  ETA: 10m\n#&gt;  ■■■■■■■                           20% |  ETA:  6m\n#&gt;  ■■■■■■■■■■                        30% |  ETA:  4m\n#&gt;  ■■■■■■■■■■■■■                     40% |  ETA:  3m\n#&gt;  ■■■■■■■■■■■■■■■■                  50% |  ETA:  2m\n#&gt;  ■■■■■■■■■■■■■■■■■■■               60% |  ETA:  2m\n#&gt;  ■■■■■■■■■■■■■■■■■■■■■■            70% |  ETA:  1m\n#&gt;  ■■■■■■■■■■■■■■■■■■■■■■■■■         80% |  ETA: 46s\n#&gt;  ■■■■■■■■■■■■■■■■■■■■■■■■■■■■      90% |  ETA: 22s\n\n\nrfb_data |&gt; glimpse()\n#&gt; Rows: 9,208,201\n#&gt; Columns: 9\n#&gt; $ cnpj_basic         &lt;chr&gt; \"33522741\", \"30193526\", \"30943196\", \"37895692\", …\n#&gt; $ cnpj_order         &lt;chr&gt; \"0001\", \"0001\", \"0001\", \"0001\", \"0001\", \"0001\", …\n#&gt; $ cnpj_dv            &lt;chr&gt; \"91\", \"04\", \"19\", \"93\", \"35\", \"12\", \"56\", \"91\", …\n#&gt; $ street_type        &lt;chr&gt; \"RUA\", \"RUA\", \"RUA\", \"RUA\", \"QUADRA\", \"AVENIDA\",…\n#&gt; $ street_name        &lt;chr&gt; \"WERNER VON SIEMENS\", \"PORTO SEGURO\", \"CARLOS VI…\n#&gt; $ number             &lt;chr&gt; \"111\", \"1020\", \"151\", \"136\", \"SN\", \"2099\", \"31\",…\n#&gt; $ address_complement &lt;chr&gt; NA, NA, \"APT   22\", NA, \"SALA  906\", NA, NA, NA,…\n#&gt; $ neighborhood       &lt;chr&gt; \"LAPA DE BAIXO\", \"NOVA VISTA\", \"VILA GUARANI (Z …\n#&gt; $ postal_code        &lt;chr&gt; \"05069900\", \"31070130\", \"04307000\", \"03715070\", …"
  },
  {
    "objectID": "index.html#tidy-the-rfb-data",
    "href": "index.html#tidy-the-rfb-data",
    "title": "",
    "section": "Tidy the RFB Data",
    "text": "Tidy the RFB Data\n\nrfb_data &lt;-\n  rfb_data |&gt;\n  mutate(\n    cnpj_basic = str_pad(cnpj_basic, 8, pad = \"0\"),\n    cnpj_order = str_pad(cnpj_order, 4, pad = \"0\"),\n    cnpj_dv = str_pad(cnpj_dv, 2, pad = \"0\"),\n    cnpj = if_else(\n      !is.na(cnpj_basic) & !is.na(cnpj_order) & !is.na(cnpj_dv),\n      paste0(\n        str_sub(cnpj_basic, 1, 2),\n        \".\", str_sub(cnpj_basic, 3, 5),\n        \".\", str_sub(cnpj_basic, 6, 8),\n        \"/\", cnpj_order,\n        \"-\", cnpj_dv\n      ),\n      NA_character_\n    )\n  ) |&gt;\n  select(-cnpj_basic, -cnpj_order, -cnpj_dv) |&gt;\n  relocate(cnpj)\n\n\nrfb_data |&gt; glimpse()\n#&gt; Rows: 9,208,201\n#&gt; Columns: 7\n#&gt; $ cnpj               &lt;chr&gt; \"33.522.741/0001-91\", \"30.193.526/0001-04\", \"30.…\n#&gt; $ street_type        &lt;chr&gt; \"RUA\", \"RUA\", \"RUA\", \"RUA\", \"QUADRA\", \"AVENIDA\",…\n#&gt; $ street_name        &lt;chr&gt; \"WERNER VON SIEMENS\", \"PORTO SEGURO\", \"CARLOS VI…\n#&gt; $ number             &lt;chr&gt; \"111\", \"1020\", \"151\", \"136\", \"SN\", \"2099\", \"31\",…\n#&gt; $ address_complement &lt;chr&gt; NA, NA, \"APT   22\", NA, \"SALA  906\", NA, NA, NA,…\n#&gt; $ neighborhood       &lt;chr&gt; \"LAPA DE BAIXO\", \"NOVA VISTA\", \"VILA GUARANI (Z …\n#&gt; $ postal_code        &lt;chr&gt; \"05069900\", \"31070130\", \"04307000\", \"03715070\", …"
  },
  {
    "objectID": "index.html#cross-reference-data-with-rfb-data",
    "href": "index.html#cross-reference-data-with-rfb-data",
    "title": "",
    "section": "Cross-Reference Data with RFB Data",
    "text": "Cross-Reference Data with RFB Data\n\nestablishment_data &lt;-\n  establishment_data |&gt;\n  left_join(rfb_data, by = \"cnpj\") |&gt;\n  relocate(starts_with(\"locaisnova\"), .after = postal_code)\n\n\nestablishment_data |&gt; glimpse()\n#&gt; Rows: 71,412\n#&gt; Columns: 19\n#&gt; $ cnpj               &lt;chr&gt; \"75.315.333/0101-71\", \"75.315.333/0277-32\", \"04.…\n#&gt; $ cnae               &lt;chr&gt; \"4711-3/01\", \"4711-3/01\", \"4711-3/01\", \"4711-3/0…\n#&gt; $ region_code        &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, …\n#&gt; $ region             &lt;chr&gt; \"North\", \"North\", \"North\", \"North\", \"North\", \"No…\n#&gt; $ state_code         &lt;int&gt; 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, …\n#&gt; $ state              &lt;chr&gt; \"Tocantins\", \"Tocantins\", \"Tocantins\", \"Tocantin…\n#&gt; $ federal_unit       &lt;chr&gt; \"TO\", \"TO\", \"TO\", \"TO\", \"TO\", \"TO\", \"TO\", \"TO\", …\n#&gt; $ municipality_code  &lt;int&gt; 1721000, 1721000, 1721000, 1721000, 1721000, 172…\n#&gt; $ municipality       &lt;chr&gt; \"Palmas\", \"Palmas\", \"Palmas\", \"Palmas\", \"Palmas\"…\n#&gt; $ street_type        &lt;chr&gt; NA, \"QUADRA\", \"QUADRA\", \"AVENIDA\", \"QUADRA\", \"QU…\n#&gt; $ street_name        &lt;chr&gt; NA, \"412 SUL AVENIDA NS 10\", \"1012 SUL ALAMEDA 5…\n#&gt; $ number             &lt;chr&gt; NA, \"S/N\", \"SN\", \"S/N\", \"S/N\", \"S/N\", \"S/N\", \"S/…\n#&gt; $ address_complement &lt;chr&gt; NA, \"QUADRAASR SE 45           LOTE  06 A 09\", \"…\n#&gt; $ neighborhood       &lt;chr&gt; NA, \"PLANO DIRETOR SUL\", \"PLANO DIRETOR SUL\", \"P…\n#&gt; $ postal_code        &lt;chr&gt; NA, \"77021230\", \"77023658\", \"77024546\", \"7702163…\n#&gt; $ locaisnova_g0      &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE,…\n#&gt; $ locaisnova_g1_g2   &lt;lgl&gt; TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, …\n#&gt; $ locaisnova_g3      &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE,…\n#&gt; $ locaisnova_g4      &lt;lgl&gt; TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, …\n\n\nestablishment_data |&gt;\n  pull(postal_code) |&gt;\n  count_na()\n#&gt; [1] 3199\n\n\n#&gt;            used  (Mb) gc trigger   (Mb)  max used   (Mb)\n#&gt; Ncells  3022707 161.5   36022166 1923.8  22889609 1222.5\n#&gt; Vcells 24008580 183.2  239886172 1830.2 298569052 2278.0"
  },
  {
    "objectID": "index.html#tidy-new-addresses",
    "href": "index.html#tidy-new-addresses",
    "title": "",
    "section": "Tidy New Addresses",
    "text": "Tidy New Addresses\n\n\n\n\n\n\nThe new addresses obtained from the RFB data are tidied up for consistency.\n\n\n\n\nestablishment_data &lt;-\n  establishment_data |&gt;\n  rename(complement = address_complement)  |&gt;\n  mutate(\n    street_type = str_to_title(street_type),\n    street_name = str_to_title(street_name),\n    address = if_else(\n      !is.na(street_type) & !is.na(street_name),\n      paste(street_type, street_name),\n      NA_character_\n    ),\n    number =\n      number |&gt;\n      str_remove_all(\"\\\\D\") |&gt;\n      str_trim() |&gt;\n      as.numeric() |&gt;\n      as.character() |&gt;\n      suppressWarnings(),\n    complement = str_to_title(complement),\n    neighborhood = str_to_title(neighborhood),\n    postal_code =\n      postal_code |&gt;\n      str_remove_all(\"\\\\D\") |&gt;\n      str_pad(pad = 0, width = 8),\n    postal_code = if_else(\n      !is.na(postal_code),\n      paste0(\n        str_sub(postal_code, 1, 5),\n        \"-\",\n        str_sub(postal_code, 6, 8)\n      ),\n      NA_character_\n    )\n  ) |&gt;\n  mutate(\n    across(\n      .cols = where(is.character),\n      .fns = function(x) {\n          Encoding(x) &lt;- \"UTF-8\"\n\n          iconv(x, from = \"\", to = \"UTF-8\", sub = \"\")\n      }\n    )\n  ) |&gt;\n  relocate(address, .after = municipality) |&gt;\n  select(-starts_with(\"street\"))\n\n\nestablishment_data |&gt; glimpse()\n#&gt; Rows: 71,412\n#&gt; Columns: 18\n#&gt; $ cnpj              &lt;chr&gt; \"75.315.333/0101-71\", \"75.315.333/0277-32\", \"04.4…\n#&gt; $ cnae              &lt;chr&gt; \"4711-3/01\", \"4711-3/01\", \"4711-3/01\", \"4711-3/01…\n#&gt; $ region_code       &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…\n#&gt; $ region            &lt;chr&gt; \"North\", \"North\", \"North\", \"North\", \"North\", \"Nor…\n#&gt; $ state_code        &lt;int&gt; 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 1…\n#&gt; $ state             &lt;chr&gt; \"Tocantins\", \"Tocantins\", \"Tocantins\", \"Tocantins…\n#&gt; $ federal_unit      &lt;chr&gt; \"TO\", \"TO\", \"TO\", \"TO\", \"TO\", \"TO\", \"TO\", \"TO\", \"…\n#&gt; $ municipality_code &lt;int&gt; 1721000, 1721000, 1721000, 1721000, 1721000, 1721…\n#&gt; $ municipality      &lt;chr&gt; \"Palmas\", \"Palmas\", \"Palmas\", \"Palmas\", \"Palmas\",…\n#&gt; $ address           &lt;chr&gt; NA, \"Quadra 412 Sul Avenida Ns 10\", \"Quadra 1012 …\n#&gt; $ number            &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, \"28\", NA, NA, NA,…\n#&gt; $ complement        &lt;chr&gt; NA, \"Quadraasr Se 45           Lote  06 A 09\", \"L…\n#&gt; $ neighborhood      &lt;chr&gt; NA, \"Plano Diretor Sul\", \"Plano Diretor Sul\", \"Pl…\n#&gt; $ postal_code       &lt;chr&gt; NA, \"77021-230\", \"77023-658\", \"77024-546\", \"77021…\n#&gt; $ locaisnova_g0     &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, …\n#&gt; $ locaisnova_g1_g2  &lt;lgl&gt; TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, T…\n#&gt; $ locaisnova_g3     &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, …\n#&gt; $ locaisnova_g4     &lt;lgl&gt; TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, T…"
  },
  {
    "objectID": "index.html#geocode-the-data",
    "href": "index.html#geocode-the-data",
    "title": "",
    "section": "Geocode the Data",
    "text": "Geocode the Data\n\n\n\n\n\n\nGeocoding is performed with the geocodebr R package, which relies on open spatial data from the Brazilian Institute of Geography and Statistics (IBGE). The package uses address information from the National Address Register for Statistical Purposes (CNEFE).\n\n\n\n\nfields &lt;- definir_campos(\n  estado = \"federal_unit\",\n  municipio = \"municipality_code\",\n  logradouro = \"address\",\n  numero = \"number\",\n  cep = \"postal_code\",\n  localidade = \"neighborhood\"\n)\n\n\nestablishment_data &lt;-\n  establishment_data |&gt;\n  geocode(\n    campos_endereco = fields,\n    resultado_sf = FALSE,\n    verboso = TRUE,\n    cache = TRUE,\n    n_cores = 4,\n    resolver_empates = TRUE\n  )\n#&gt; ℹ Padronizando endereços de entrada\n#&gt; ℹ Utilizando dados do CNEFE armazenados localmente\n#&gt; ℹ Geolocalizando endereços\n#&gt; Endereços processados: 0/71,412 ■                                  0% - Proc…\n#&gt; \n#&gt; Endereços processados: 17,554/71,412 ■■■■■■■■                          25% -…\n#&gt; \n#&gt; Endereços processados: 30,397/71,412 ■■■■■■■■■■■■■■                    43% -…\n#&gt; \n#&gt; Endereços processados: 31,293/71,412 ■■■■■■■■■■■■■■                    44% -…\n#&gt; \n#&gt; Endereços processados: 32,284/71,412 ■■■■■■■■■■■■■■■                   45% -…\n#&gt; \n#&gt; Endereços processados: 42,819/71,412 ■■■■■■■■■■■■■■■■■■■               60% -…\n#&gt; \n#&gt; Endereços processados: 48,426/71,412 ■■■■■■■■■■■■■■■■■■■■■             68% -…\n#&gt; \n#&gt; Endereços processados: 48,932/71,412 ■■■■■■■■■■■■■■■■■■■■■■            69% -…\n#&gt; \n#&gt; Endereços processados: 49,432/71,412 ■■■■■■■■■■■■■■■■■■■■■■            69% -…\n#&gt; \n#&gt; Endereços processados: 50,776/71,412 ■■■■■■■■■■■■■■■■■■■■■■            71% -…\n#&gt; \n#&gt; Endereços processados: 51,655/71,412 ■■■■■■■■■■■■■■■■■■■■■■■           72% -…\n#&gt; \n#&gt; Endereços processados: 51,756/71,412 ■■■■■■■■■■■■■■■■■■■■■■■           72% -…\n#&gt; \n#&gt; Endereços processados: 52,014/71,412 ■■■■■■■■■■■■■■■■■■■■■■■           73% -…\n#&gt; \n#&gt; Endereços processados: 52,601/71,412 ■■■■■■■■■■■■■■■■■■■■■■■           74% -…\n#&gt; \n#&gt; Endereços processados: 53,238/71,412 ■■■■■■■■■■■■■■■■■■■■■■■           75% -…\n#&gt; \n#&gt; Endereços processados: 53,822/71,412 ■■■■■■■■■■■■■■■■■■■■■■■■          75% -…\n#&gt; \n#&gt; Endereços processados: 54,047/71,412 ■■■■■■■■■■■■■■■■■■■■■■■■          76% -…\n#&gt; \n#&gt; Endereços processados: 54,432/71,412 ■■■■■■■■■■■■■■■■■■■■■■■■          76% -…\n#&gt; \n#&gt; Endereços processados: 54,473/71,412 ■■■■■■■■■■■■■■■■■■■■■■■■          76% -…\n#&gt; \n#&gt; Endereços processados: 54,510/71,412 ■■■■■■■■■■■■■■■■■■■■■■■■          76% -…\n#&gt; \n#&gt; Endereços processados: 54,531/71,412 ■■■■■■■■■■■■■■■■■■■■■■■■          76% -…\n#&gt; \n#&gt; Endereços processados: 54,608/71,412 ■■■■■■■■■■■■■■■■■■■■■■■■          76% -…\n#&gt; \n#&gt; Endereços processados: 59,588/71,412 ■■■■■■■■■■■■■■■■■■■■■■■■■■        83% -…\n#&gt; \n#&gt; Endereços processados: 66,535/71,412 ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■     93% -…\n#&gt; \n#&gt; Endereços processados: 67,603/71,412 ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■     95% -…\n#&gt; \n#&gt; Endereços processados: 71,412/71,412 ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■  100% -…\n#&gt; \n#&gt; \n#&gt; \n#&gt; ℹ Preparando resultados\n#&gt; Foram encontrados e resolvidos 1949 casos de empate.\n\n\nestablishment_data &lt;-\n  establishment_data |&gt;\n  as_tibble() |&gt;\n  rename(\n    latitude = lat,\n    longitude = lon,\n    geocodebr_precision = precisao,\n    geocodebr_type_of_result = tipo_resultado,\n    geocodebr_deviation_meters = desvio_metros,\n    geocodebr_address_found = endereco_encontrado,\n    geocodebr_ambiguous = empate\n  ) |&gt;\n  relocate(starts_with(\"locaisnova\"), .after = geocodebr_ambiguous) |&gt;\n  drop_na(all_of(c(\"latitude\", \"longitude\")))\n\n\nestablishment_data |&gt; glimpse()\n#&gt; Rows: 71,412\n#&gt; Columns: 25\n#&gt; $ cnpj                       &lt;chr&gt; \"75.315.333/0101-71\", \"75.315.333/0277-3…\n#&gt; $ cnae                       &lt;chr&gt; \"4711-3/01\", \"4711-3/01\", \"4711-3/01\", \"…\n#&gt; $ region_code                &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…\n#&gt; $ region                     &lt;chr&gt; \"North\", \"North\", \"North\", \"North\", \"Nor…\n#&gt; $ state_code                 &lt;int&gt; 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, …\n#&gt; $ state                      &lt;chr&gt; \"Tocantins\", \"Tocantins\", \"Tocantins\", \"…\n#&gt; $ federal_unit               &lt;chr&gt; \"TO\", \"TO\", \"TO\", \"TO\", \"TO\", \"TO\", \"TO\"…\n#&gt; $ municipality_code          &lt;int&gt; 1721000, 1721000, 1721000, 1721000, 1721…\n#&gt; $ municipality               &lt;chr&gt; \"Palmas\", \"Palmas\", \"Palmas\", \"Palmas\", …\n#&gt; $ address                    &lt;chr&gt; NA, \"Quadra 412 Sul Avenida Ns 10\", \"Qua…\n#&gt; $ number                     &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, \"28\", NA…\n#&gt; $ complement                 &lt;chr&gt; NA, \"Quadraasr Se 45           Lote  06 …\n#&gt; $ neighborhood               &lt;chr&gt; NA, \"Plano Diretor Sul\", \"Plano Diretor …\n#&gt; $ postal_code                &lt;chr&gt; NA, \"77021-230\", \"77023-658\", \"77024-546…\n#&gt; $ latitude                   &lt;dbl&gt; -10.25185979, -10.25147969, -10.24655266…\n#&gt; $ longitude                  &lt;dbl&gt; -48.32112949, -48.36765397, -48.31424751…\n#&gt; $ geocodebr_precision        &lt;chr&gt; \"municipio\", \"localidade\", \"cep\", \"cep\",…\n#&gt; $ geocodebr_type_of_result   &lt;chr&gt; \"dm01\", \"db01\", \"dc02\", \"dc02\", \"dc02\", …\n#&gt; $ geocodebr_deviation_meters &lt;int&gt; 13566, 3172, 59, 166, 6, 6, 258, 2550, 8…\n#&gt; $ geocodebr_address_found    &lt;chr&gt; \"PALMAS - TO\", \"PLANO DIRETOR SUL, PALMA…\n#&gt; $ geocodebr_ambiguous        &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSE, FALSE…\n#&gt; $ locaisnova_g0              &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSE, FALSE…\n#&gt; $ locaisnova_g1_g2           &lt;lgl&gt; TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE…\n#&gt; $ locaisnova_g3              &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSE, FALSE…\n#&gt; $ locaisnova_g4              &lt;lgl&gt; TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE…"
  },
  {
    "objectID": "index.html#visualize-geocode-precision",
    "href": "index.html#visualize-geocode-precision",
    "title": "",
    "section": "Visualize Geocode Precision",
    "text": "Visualize Geocode Precision\n\nestablishment_data |&gt;\n  ggplot(aes(geocodebr_precision)) +\n  geom_bar(fill = get_brand_color(\"blue\")) +\n  labs(\n    x = \"{geocodebr} Precision\",\n    y = \"Frequency\"\n  )"
  },
  {
    "objectID": "index.html#data-dictionary",
    "href": "index.html#data-dictionary",
    "title": "",
    "section": "Data Dictionary",
    "text": "Data Dictionary\n\nmetadata &lt;-\n  establishment_data |&gt;\n  `var_label&lt;-`(\n    list(\n      cnpj = \"CNPJ number\",\n      cnae = \"Primary activity CNAE\",\n      region_code = \"IBGE region code\",\n      region = \"Region name\",\n      state_code = \"IBGE state code\",\n      state = \"State name\",\n      federal_unit = \"Federal unit abbreviation\",\n      municipality_code = \"IBGE municipality code\",\n      municipality = \"Municipality name\",\n      address = \"Street address\",\n      number = \"Address number\",\n      complement = \"Address complement\",\n      neighborhood = \"Neighborhood\",\n      postal_code = \"Postal code\",\n      latitude = \"Latitude\",\n      longitude = \"Longitude\",\n      geocodebr_precision = \"{geocodebr} precision value\",\n      geocodebr_type_of_result = \"{geocodebr} result type\",\n      geocodebr_deviation_meters = \"{geocodebr} deviation (meters)\",\n      geocodebr_address_found = \"{geocodebr} address returned\",\n      geocodebr_ambiguous = \"{geocodebr} ambiguous result\",\n      locaisnova_g0 = \"Locais-Nova Group 0 indicator\",\n      locaisnova_g1_g2 = \"Locais-Nova Groups 1 and 2 indicator\",\n      locaisnova_g3 = \"Locais-Nova Group 3 indicator\",\n      locaisnova_g4 = \"Locais-Nova Group 4 indicator\"\n    )\n  ) |&gt;\n  generate_dictionary(details = \"full\") |&gt;\n  convert_list_columns_to_character()\n\n\nmetadata\n\n\n  \n\n\n\n\nestablishment_data"
  },
  {
    "objectID": "index.html#save-the-valid-data",
    "href": "index.html#save-the-valid-data",
    "title": "",
    "section": "Save the Valid Data",
    "text": "Save the Valid Data\n\n\n\n\n\n\nThe processed data are available in csv, rds and parquet formats through a dedicated repository on the Open Science Framework (OSF). See the Data Availability section for more information.\n\n\n\nClean Old Data Files\n\nif (dir_exists(data_dir)) {\n  dir_delete(data_dir)\n  dir_create(data_dir, recurse = TRUE)\n}\n\nWrite Data\n\nvalid_file_pattern &lt;- \"2022\"\n\n\nestablishment_data |&gt;\n  write_csv(\n    here(data_dir, paste0(valid_file_pattern, \".csv\"))\n  )\n\n\nestablishment_data |&gt;\n  write_rds(\n    here(data_dir, paste0(valid_file_pattern, \".rds\"))\n  )\n\n\nestablishment_data |&gt;\n  write_parquet(\n    here(data_dir, paste0(valid_file_pattern, \".parquet\"))\n  )\n\nLock Data\n\nhere(data_dir, paste0(valid_file_pattern, \".csv\")) |&gt;\n  lock_file(\n    public_key = public_key,\n    suffix = \".lockr\",\n    remove_file = TRUE\n  )\n\n\nhere(data_dir, paste0(valid_file_pattern, \".rds\")) |&gt;\n  lock_file(\n    public_key = public_key,\n    suffix = \".lockr\",\n    remove_file = TRUE\n  )\n\n\nhere(data_dir, paste0(valid_file_pattern, \".parquet\")) |&gt;\n  lock_file(\n    public_key = public_key,\n    suffix = \".lockr\",\n    remove_file = TRUE\n  )\n\nWrite Metadata\n\nmetadata_file_pattern &lt;- paste0(\n  \"2022\",\n  \"-\",\n  \"metadata\"\n)\n\n\nmetadata |&gt;\n  write_csv(\n    here(\"data\", paste0(metadata_file_pattern, \".csv\"))\n  )\n\n\nmetadata |&gt;\n  write_rds(\n    here(\"data\", paste0(metadata_file_pattern, \".rds\"))\n  )"
  },
  {
    "objectID": "index.html#visualize-geocoding",
    "href": "index.html#visualize-geocoding",
    "title": "",
    "section": "Visualize Geocoding",
    "text": "Visualize Geocoding\n\nfor (i in municipalities) {\n  # Set Shape -----\n\n  shape &lt;-\n    i |&gt;\n    read_municipality(\n      year = closest_geobr_year(year, verbose = FALSE),\n      showProgress = FALSE\n    ) |&gt;\n    st_transform(st_crs(4326)) |&gt;\n    suppressMessages()\n\n  # Prepare Data -----\n\n  plot_data &lt;-\n    establishment_data |&gt;\n    filter(municipality_code == i) |&gt;\n    pivot_longer(\n      cols = all_of(\n        c(\"locaisnova_g0\", \"locaisnova_g1_g2\", \"locaisnova_g3\", \"locaisnova_g4\")\n      ),\n      names_to = \"group\",\n      values_to = \"value\"\n    ) |&gt;\n    filter(value == TRUE) |&gt;\n    st_as_sf(\n      coords = c(\"longitude\", \"latitude\"),\n      crs = 4326\n    ) |&gt;\n    st_join(shape, join = st_within, left = FALSE) %&gt;%\n    mutate(\n      latitude = st_coordinates(.)[,2],\n      longitude = st_coordinates(.)[,1]\n    ) |&gt;\n    st_drop_geometry() |&gt;\n    transmute(\n      group =\n        group |&gt;\n        str_remove(\"locaisnova_\") |&gt;\n        str_to_upper() |&gt;\n        str_replace(\"_\", \"-\"),\n      latitude,\n      longitude\n    )\n\n  # Plot Data ---\n\n  plot &lt;-\n    ggplot() +\n    geom_sf(\n      data = shape,\n      fill = \"gray90\",\n      color = \"black\"\n    ) +\n    geom_point(\n      data = plot_data,\n      mapping = aes(x = longitude, y = latitude, color = group),\n      size = 0.01\n    ) +\n    facet_wrap(~ group, ncol = 4) +\n    coord_sf(crs = 4326) +\n    scale_x_continuous(labels = NULL, breaks = NULL) +\n    scale_y_continuous(labels = NULL, breaks = NULL) +\n    scale_colour_brand_d() +\n    theme(legend.position = \"none\") +\n    labs(\n      title = paste(\n        \"Locais-Nova Establishments in\",\n        municipalities_data |&gt;\n          filter(municipality_code == i) |&gt;\n          pull(municipality)\n      ),\n      x = NULL,\n      y = NULL,\n      color = NULL,\n      caption =\n        paste0(\n          \"Source: \",\n          \"Brazilian Federal Revenue Service (RFB), as of \",\n          month.name[month], \" \",\n          year,\n          \".\"\n        )\n    )\n\n  print(plot)\n}"
  },
  {
    "objectID": "index.html#citation",
    "href": "index.html#citation",
    "title": "",
    "section": "Citation",
    "text": "Citation\n\n\n\n\n\n\nWhen using this data, you must also cite the original data sources.\n\n\n\nTo cite this work, please use the following format:\nCaldeira, G., Penz, C., Vartanian, D., Fernandes, C. N., & Giannotti, M. A. (2025). A reproducible pipeline for processing, geocoding, and classifying CNPJs from the Annual Social Information Report (RAIS) of the Brazilian Ministry of Labor and Employment (MTE) using the Locais-Nova scale [Computer software]. Center for Metropolitan Studies of the University of São Paulo. https://cem-usp.github.io/locais-nova-rais-geocoding\nA BibLaTeX entry for LaTeX users is:\n@software{caldeira2025,\n  title = {A reproducible pipeline for processing, geocoding, and classifying CNPJs from the Annual Social Information Report (RAIS) of the Brazilian Ministry of Labor and Employment (MTE) using the Locais-Nova scale},\n  author = {{Gabriel Caldeira} and {Clara Penz} and {Daniel Vartanian} and {Camila Nastari Fernandes} and {Mariana Abrantes Giannotti}},\n  year = {2025},\n  address = {São Paulo},\n  institution = {Center for Metropolitan Studies of the University of São Paulo},\n  langid = {en},\n  url = {https://cem-usp.github.io/locais-nova-rais-geocoding}\n}"
  },
  {
    "objectID": "index.html#license",
    "href": "index.html#license",
    "title": "",
    "section": "License",
    "text": "License\n\n \n\n\n\n\n\n\n\nThe original data sources may be subject to their own licensing terms and conditions.\n\n\n\nThe code in this report is licensed under the GNU General Public License Version 3, while the report is available under the Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International.\nCopyright (C) 2025 Center for Metropolitan Studies\n\nThe code in this report is free software: you can redistribute it and/or\nmodify it under the terms of the GNU General Public License as published by the\nFree Software Foundation, either version 3 of the License, or (at your option)\nany later version.\n\nThis program is distributed in the hope that it will be useful, but WITHOUT ANY\nWARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A\nPARTICULAR PURPOSE. See the GNU General Public License for more details.\n\nYou should have received a copy of the GNU General Public License along with\nthis program. If not, see &lt;https://www.gnu.org/licenses/&gt;."
  },
  {
    "objectID": "index.html#acknowledgments",
    "href": "index.html#acknowledgments",
    "title": "",
    "section": "Acknowledgments",
    "text": "Acknowledgments\n\n\n\n\n\nThis work is part of a research project by the Polytechnic School (Poli) of the University of São Paulo (USP), in partnership with the Secretariat for Food and Nutrition Security (SESAN) of the Ministry of Social Development, Family, and the Fight Against Hunger (MDS), titled: AcessoSAN: Mapping Food Access to Support Public Policies on Food and Nutrition Security and Hunger Reduction in Brazilian Cities.\n\n\n\n\n\n\nThis work was developed with support from the Center for Metropolitan Studies (CEM) based at the School of Philosophy, Letters and Human Sciences (FFLCH) of the University of São Paulo (USP) and at the Brazilian Center for Analysis and Planning (CEBRAP).\n\n\n\n\n\n\nThis study was financed, in part, by the São Paulo Research Foundation (FAPESP), Brazil. Process Number 2025/17879-2."
  },
  {
    "objectID": "index.html#references",
    "href": "index.html#references",
    "title": "",
    "section": "References",
    "text": "References\n\n\nAho, A., Kernighan, B., & Weinberger, P. (2023). The AWK programming language. Addison-Wesley Professional. https://www.awk.dev\n\n\nR Core Team. (n.d.). R: A language and environment for statistical computing [Computer software]. R Foundation for Statistical Computing. https://www.R-project.org\n\n\nUshey, K., & Wickham, H. (n.d.). renv: Project environments [Computer software]. https://doi.org/10.32614/CRAN.package.renv\n\n\nWickham, H. (2023). The tidy tools manifesto. Tidyverse. https://tidyverse.tidyverse.org/articles/manifesto.html\n\n\nWickham, H., Çetinkaya-Rundel, M., & Grolemund, G. (2023). R for data science: Import, tidy, transform, visualize, and model data (2nd ed.). O’Reilly Media. https://r4ds.hadley.nz"
  }
]